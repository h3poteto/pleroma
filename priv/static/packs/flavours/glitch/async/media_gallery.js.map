{"version":3,"sources":["webpack:///flavours/glitch/async/media_gallery.js","webpack:///app/javascript/mnt/gentoo/home/haelwenn/Sources/git/hacktivis.me/git/mastofe/app/javascript/flavours/glitch/components/media_gallery.js"],"names":["webpackJsonp","846","module","__webpack_exports__","__webpack_require__","Object","defineProperty","value","d","MediaGallery","_class","_temp2","_class2","_class3","_temp4","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default","n","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn__","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn___default","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits__","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits___default","__WEBPACK_IMPORTED_MODULE_4_react__","__WEBPACK_IMPORTED_MODULE_4_react___default","__WEBPACK_IMPORTED_MODULE_5_immutable__","__WEBPACK_IMPORTED_MODULE_6__icon_button__","__WEBPACK_IMPORTED_MODULE_7_react_intl__","__WEBPACK_IMPORTED_MODULE_8_flavours_glitch_util_is_mobile__","__WEBPACK_IMPORTED_MODULE_9_classnames__","__WEBPACK_IMPORTED_MODULE_9_classnames___default","__WEBPACK_IMPORTED_MODULE_10_flavours_glitch_util_initial_state__","messages","hidden","id","defaultMessage","sensitive","toggle","toggle_visible","warning","Item","_React$PureComponent","_temp","_this","_ret","this","_len","arguments","length","args","Array","_key","call","apply","concat","handleMouseEnter","e","hoverToPlay","target","play","handleMouseLeave","pause","currentTime","handleClick","_this$props","props","index","onClick","button","preventDefault","stopPropagation","prototype","attachment","get","render","_props","size","standalone","letterbox","displayWidth","width","height","top","left","bottom","right","thumbnail","previewUrl","previewWidth","getIn","originalUrl","originalWidth","hasSize","srcSet","sizes","focusX","focusY","x","y","className","href","src","alt","title","style","objectPosition","autoPlay","autoplay","aria-label","role","onMouseEnter","onMouseLeave","loop","muted","a","PureComponent","defaultProps","_React$PureComponent2","_temp3","_this2","_ret2","_len2","_key2","state","visible","undefined","revealed","handleOpen","setState","onOpenMedia","media","handleRef","node","offsetWidth","componentWillReceiveProps","nextProps","isStandaloneEligible","_props2","_this3","_props3","intl","fullwidth","_state","take","children","map","i","createElement","type","computedClass","full-width","ref","icon","overlay","formatMessage"],"mappings":"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","file":"flavours/glitch/async/media_gallery.js","sourcesContent":["webpackJsonp([69],{\n\n/***/ 846:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return MediaGallery; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_react__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_react___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_react__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_immutable__ = __webpack_require__(6);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_immutable___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_immutable__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__icon_button__ = __webpack_require__(151);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_react_intl__ = __webpack_require__(7);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_flavours_glitch_util_is_mobile__ = __webpack_require__(403);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9_classnames__ = __webpack_require__(10);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9_classnames___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_9_classnames__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10_flavours_glitch_util_initial_state__ = __webpack_require__(53);\n\n\n\n\n\nvar _class, _temp2, _class2, _class3, _temp4;\n\n\n\n\n\n\n\n\n\n\nvar messages = Object(__WEBPACK_IMPORTED_MODULE_7_react_intl__[\"f\" /* defineMessages */])({\n  hidden: {\n    'id': 'status.media_hidden',\n    'defaultMessage': 'Media hidden'\n  },\n  sensitive: {\n    'id': 'media_gallery.sensitive',\n    'defaultMessage': 'Sensitive'\n  },\n  toggle: {\n    'id': 'status.sensitive_toggle',\n    'defaultMessage': 'Click to view'\n  },\n  toggle_visible: {\n    'id': 'media_gallery.toggle_visible',\n    'defaultMessage': 'Toggle visibility'\n  },\n  warning: {\n    'id': 'status.sensitive_warning',\n    'defaultMessage': 'Sensitive content'\n  }\n});\n\nvar Item = (_temp2 = _class = function (_React$PureComponent) {\n  __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits___default()(Item, _React$PureComponent);\n\n  function Item() {\n    var _temp, _this, _ret;\n\n    __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this, Item);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn___default()(this, _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args))), _this), _this.handleMouseEnter = function (e) {\n      if (_this.hoverToPlay()) {\n        e.target.play();\n      }\n    }, _this.handleMouseLeave = function (e) {\n      if (_this.hoverToPlay()) {\n        e.target.pause();\n        e.target.currentTime = 0;\n      }\n    }, _this.handleClick = function (e) {\n      var _this$props = _this.props,\n          index = _this$props.index,\n          onClick = _this$props.onClick;\n\n\n      if (e.button === 0) {\n        e.preventDefault();\n        onClick(index);\n      }\n\n      e.stopPropagation();\n    }, _temp), __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn___default()(_this, _ret);\n  }\n\n  Item.prototype.hoverToPlay = function hoverToPlay() {\n    var attachment = this.props.attachment;\n\n    return !__WEBPACK_IMPORTED_MODULE_10_flavours_glitch_util_initial_state__[\"a\" /* autoPlayGif */] && attachment.get('type') === 'gifv';\n  };\n\n  Item.prototype.render = function render() {\n    var _props = this.props,\n        attachment = _props.attachment,\n        index = _props.index,\n        size = _props.size,\n        standalone = _props.standalone,\n        letterbox = _props.letterbox,\n        displayWidth = _props.displayWidth;\n\n\n    var width = 50;\n    var height = 100;\n    var top = 'auto';\n    var left = 'auto';\n    var bottom = 'auto';\n    var right = 'auto';\n\n    if (size === 1) {\n      width = 100;\n    }\n\n    if (size === 4 || size === 3 && index > 0) {\n      height = 50;\n    }\n\n    if (size === 2) {\n      if (index === 0) {\n        right = '2px';\n      } else {\n        left = '2px';\n      }\n    } else if (size === 3) {\n      if (index === 0) {\n        right = '2px';\n      } else if (index > 0) {\n        left = '2px';\n      }\n\n      if (index === 1) {\n        bottom = '2px';\n      } else if (index > 1) {\n        top = '2px';\n      }\n    } else if (size === 4) {\n      if (index === 0 || index === 2) {\n        right = '2px';\n      }\n\n      if (index === 1 || index === 3) {\n        left = '2px';\n      }\n\n      if (index < 2) {\n        bottom = '2px';\n      } else {\n        top = '2px';\n      }\n    }\n\n    var thumbnail = '';\n\n    if (attachment.get('type') === 'image') {\n      var previewUrl = attachment.get('preview_url');\n      var previewWidth = attachment.getIn(['meta', 'small', 'width']);\n\n      var originalUrl = attachment.get('url');\n      var originalWidth = attachment.getIn(['meta', 'original', 'width']);\n\n      var hasSize = typeof originalWidth === 'number' && typeof previewWidth === 'number';\n\n      var srcSet = hasSize ? originalUrl + ' ' + originalWidth + 'w, ' + previewUrl + ' ' + previewWidth + 'w' : null;\n      var sizes = hasSize ? displayWidth * (width / 100) + 'px' : null;\n\n      var focusX = attachment.getIn(['meta', 'focus', 'x']) || 0;\n      var focusY = attachment.getIn(['meta', 'focus', 'y']) || 0;\n      var x = (focusX / 2 + .5) * 100;\n      var y = (focusY / -2 + .5) * 100;\n\n      thumbnail = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('a', {\n        className: 'media-gallery__item-thumbnail',\n        href: attachment.get('remote_url') || originalUrl,\n        onClick: this.handleClick,\n        target: '_blank'\n      }, void 0, __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('img', {\n        className: letterbox ? 'letterbox' : null,\n        src: previewUrl,\n        srcSet: srcSet,\n        sizes: sizes,\n        alt: attachment.get('description'),\n        title: attachment.get('description'),\n        style: { objectPosition: x + '% ' + y + '%' }\n      }));\n    } else if (attachment.get('type') === 'gifv') {\n      var autoPlay = !Object(__WEBPACK_IMPORTED_MODULE_8_flavours_glitch_util_is_mobile__[\"a\" /* isIOS */])() && __WEBPACK_IMPORTED_MODULE_10_flavours_glitch_util_initial_state__[\"a\" /* autoPlayGif */];\n\n      thumbnail = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('div', {\n        className: __WEBPACK_IMPORTED_MODULE_9_classnames___default()('media-gallery__gifv', { autoplay: autoPlay })\n      }, void 0, __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('video', {\n        className: 'media-gallery__item-gifv-thumbnail' + (letterbox ? ' letterbox' : ''),\n        'aria-label': attachment.get('description'),\n        role: 'application',\n        src: attachment.get('url'),\n        onClick: this.handleClick,\n        onMouseEnter: this.handleMouseEnter,\n        onMouseLeave: this.handleMouseLeave,\n        autoPlay: autoPlay,\n        loop: true,\n        muted: true\n      }), __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('span', {\n        className: 'media-gallery__gifv__label'\n      }, void 0, 'GIF'));\n    }\n\n    return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('div', {\n      className: __WEBPACK_IMPORTED_MODULE_9_classnames___default()('media-gallery__item', { standalone: standalone }),\n      style: { left: left, top: top, right: right, bottom: bottom, width: width + '%', height: height + '%' }\n    }, attachment.get('id'), thumbnail);\n  };\n\n  return Item;\n}(__WEBPACK_IMPORTED_MODULE_4_react___default.a.PureComponent), _class.defaultProps = {\n  standalone: false,\n  index: 0,\n  size: 1\n}, _temp2);\n\nvar MediaGallery = Object(__WEBPACK_IMPORTED_MODULE_7_react_intl__[\"g\" /* injectIntl */])(_class2 = (_temp4 = _class3 = function (_React$PureComponent2) {\n  __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_inherits___default()(MediaGallery, _React$PureComponent2);\n\n  function MediaGallery() {\n    var _temp3, _this2, _ret2;\n\n    __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this, MediaGallery);\n\n    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return _ret2 = (_temp3 = (_this2 = __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn___default()(this, _React$PureComponent2.call.apply(_React$PureComponent2, [this].concat(args))), _this2), _this2.state = {\n      visible: _this2.props.revealed === undefined ? !_this2.props.sensitive || __WEBPACK_IMPORTED_MODULE_10_flavours_glitch_util_initial_state__[\"e\" /* displaySensitiveMedia */] : _this2.props.revealed\n    }, _this2.handleOpen = function () {\n      _this2.setState({ visible: !_this2.state.visible });\n    }, _this2.handleClick = function (index) {\n      _this2.props.onOpenMedia(_this2.props.media, index);\n    }, _this2.handleRef = function (node) {\n      if (node /*&& this.isStandaloneEligible()*/) {\n          // offsetWidth triggers a layout, so only calculate when we need to\n          _this2.setState({\n            width: node.offsetWidth\n          });\n        }\n    }, _temp3), __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_possibleConstructorReturn___default()(_this2, _ret2);\n  }\n\n  MediaGallery.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (!Object(__WEBPACK_IMPORTED_MODULE_5_immutable__[\"is\"])(nextProps.media, this.props.media)) {\n      this.setState({ visible: !nextProps.sensitive });\n    }\n  };\n\n  MediaGallery.prototype.isStandaloneEligible = function isStandaloneEligible() {\n    var _props2 = this.props,\n        media = _props2.media,\n        standalone = _props2.standalone;\n\n    return standalone && media.size === 1 && media.getIn([0, 'meta', 'small', 'aspect']);\n  };\n\n  MediaGallery.prototype.render = function render() {\n    var _this3 = this;\n\n    var _props3 = this.props,\n        media = _props3.media,\n        intl = _props3.intl,\n        sensitive = _props3.sensitive,\n        letterbox = _props3.letterbox,\n        fullwidth = _props3.fullwidth;\n    var _state = this.state,\n        width = _state.width,\n        visible = _state.visible;\n\n    var size = media.take(4).size;\n\n    var children = void 0;\n\n    var style = {};\n\n    if (this.isStandaloneEligible() && width) {\n      style.height = width / this.props.media.getIn([0, 'meta', 'small', 'aspect']);\n    }\n\n    if (!visible) {\n      var warning = __WEBPACK_IMPORTED_MODULE_4_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_7_react_intl__[\"b\" /* FormattedMessage */], sensitive ? messages.warning : messages.hidden);\n\n      children = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('button', {\n        className: 'media-spoiler',\n        type: 'button',\n        onClick: this.handleOpen\n      }, void 0, __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('span', {\n        className: 'media-spoiler__warning'\n      }, void 0, warning), __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('span', {\n        className: 'media-spoiler__trigger'\n      }, void 0, __WEBPACK_IMPORTED_MODULE_4_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_7_react_intl__[\"b\" /* FormattedMessage */], messages.toggle)));\n    } else {\n      if (this.isStandaloneEligible()) {\n        children = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()(Item, {\n          standalone: true,\n          attachment: media.get(0),\n          onClick: this.handleClick,\n          displayWidth: width\n        });\n      } else {\n        children = media.take(4).map(function (attachment, i) {\n          return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()(Item, {\n            onClick: _this3.handleClick,\n            attachment: attachment,\n            index: i,\n            size: size,\n            letterbox: letterbox,\n            displayWidth: width\n          }, attachment.get('id'));\n        });\n      }\n    }\n\n    var computedClass = __WEBPACK_IMPORTED_MODULE_9_classnames___default()('media-gallery', 'size-' + size, { 'full-width': fullwidth });\n\n    return __WEBPACK_IMPORTED_MODULE_4_react___default.a.createElement(\n      'div',\n      { className: computedClass, style: style, ref: this.handleRef },\n      visible ? __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('div', {\n        className: 'sensitive-info'\n      }, void 0, __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()(__WEBPACK_IMPORTED_MODULE_6__icon_button__[\"a\" /* default */], {\n        icon: 'eye',\n        onClick: this.handleOpen,\n        overlay: true,\n        title: intl.formatMessage(messages.toggle_visible)\n      }), sensitive ? __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_jsx___default()('span', {\n        className: 'sensitive-marker'\n      }, void 0, __WEBPACK_IMPORTED_MODULE_4_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_7_react_intl__[\"b\" /* FormattedMessage */], messages.sensitive)) : null) : null,\n      children\n    );\n  };\n\n  return MediaGallery;\n}(__WEBPACK_IMPORTED_MODULE_4_react___default.a.PureComponent), _class3.defaultProps = {\n  standalone: false\n}, _temp4)) || _class2;\n\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// flavours/glitch/async/media_gallery.js","import React from 'react';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport PropTypes from 'prop-types';\nimport { is } from 'immutable';\nimport IconButton from './icon_button';\nimport { defineMessages, injectIntl, FormattedMessage } from 'react-intl';\nimport { isIOS } from 'flavours/glitch/util/is_mobile';\nimport classNames from 'classnames';\nimport { autoPlayGif, displaySensitiveMedia } from 'flavours/glitch/util/initial_state';\n\nconst messages = defineMessages({\n  hidden: {\n    defaultMessage: 'Media hidden',\n    id: 'status.media_hidden',\n  },\n  sensitive: {\n    defaultMessage: 'Sensitive',\n    id: 'media_gallery.sensitive',\n  },\n  toggle: {\n    defaultMessage: 'Click to view',\n    id: 'status.sensitive_toggle',\n  },\n  toggle_visible: {\n    defaultMessage: 'Toggle visibility',\n    id: 'media_gallery.toggle_visible',\n  },\n  warning: {\n    defaultMessage: 'Sensitive content',\n    id: 'status.sensitive_warning',\n  },\n});\n\nclass Item extends React.PureComponent {\n\n  static propTypes = {\n    attachment: ImmutablePropTypes.map.isRequired,\n    standalone: PropTypes.bool,\n    index: PropTypes.number.isRequired,\n    size: PropTypes.number.isRequired,\n    letterbox: PropTypes.bool,\n    onClick: PropTypes.func.isRequired,\n    displayWidth: PropTypes.number,\n  };\n\n  static defaultProps = {\n    standalone: false,\n    index: 0,\n    size: 1,\n  };\n\n  handleMouseEnter = (e) => {\n    if (this.hoverToPlay()) {\n      e.target.play();\n    }\n  }\n\n  handleMouseLeave = (e) => {\n    if (this.hoverToPlay()) {\n      e.target.pause();\n      e.target.currentTime = 0;\n    }\n  }\n\n  hoverToPlay () {\n    const { attachment } = this.props;\n    return !autoPlayGif && attachment.get('type') === 'gifv';\n  }\n\n  handleClick = (e) => {\n    const { index, onClick } = this.props;\n\n    if (e.button === 0) {\n      e.preventDefault();\n      onClick(index);\n    }\n\n    e.stopPropagation();\n  }\n\n  render () {\n    const { attachment, index, size, standalone, letterbox, displayWidth } = this.props;\n\n    let width  = 50;\n    let height = 100;\n    let top    = 'auto';\n    let left   = 'auto';\n    let bottom = 'auto';\n    let right  = 'auto';\n\n    if (size === 1) {\n      width = 100;\n    }\n\n    if (size === 4 || (size === 3 && index > 0)) {\n      height = 50;\n    }\n\n    if (size === 2) {\n      if (index === 0) {\n        right = '2px';\n      } else {\n        left = '2px';\n      }\n    } else if (size === 3) {\n      if (index === 0) {\n        right = '2px';\n      } else if (index > 0) {\n        left = '2px';\n      }\n\n      if (index === 1) {\n        bottom = '2px';\n      } else if (index > 1) {\n        top = '2px';\n      }\n    } else if (size === 4) {\n      if (index === 0 || index === 2) {\n        right = '2px';\n      }\n\n      if (index === 1 || index === 3) {\n        left = '2px';\n      }\n\n      if (index < 2) {\n        bottom = '2px';\n      } else {\n        top = '2px';\n      }\n    }\n\n    let thumbnail = '';\n\n    if (attachment.get('type') === 'image') {\n      const previewUrl   = attachment.get('preview_url');\n      const previewWidth = attachment.getIn(['meta', 'small', 'width']);\n\n      const originalUrl    = attachment.get('url');\n      const originalWidth  = attachment.getIn(['meta', 'original', 'width']);\n\n      const hasSize = typeof originalWidth === 'number' && typeof previewWidth === 'number';\n\n      const srcSet = hasSize ? `${originalUrl} ${originalWidth}w, ${previewUrl} ${previewWidth}w` : null;\n      const sizes  = hasSize ? `${displayWidth * (width / 100)}px` : null;\n\n      const focusX = attachment.getIn(['meta', 'focus', 'x']) || 0;\n      const focusY = attachment.getIn(['meta', 'focus', 'y']) || 0;\n      const x      = ((focusX /  2) + .5) * 100;\n      const y      = ((focusY / -2) + .5) * 100;\n\n      thumbnail = (\n        <a\n          className='media-gallery__item-thumbnail'\n          href={attachment.get('remote_url') || originalUrl}\n          onClick={this.handleClick}\n          target='_blank'\n        >\n          <img\n            className={letterbox ? 'letterbox' : null}\n            src={previewUrl}\n            srcSet={srcSet}\n            sizes={sizes}\n            alt={attachment.get('description')}\n            title={attachment.get('description')}\n            style={{ objectPosition: `${x}% ${y}%` }} />\n        </a>\n      );\n    } else if (attachment.get('type') === 'gifv') {\n      const autoPlay = !isIOS() && autoPlayGif;\n\n      thumbnail = (\n        <div className={classNames('media-gallery__gifv', { autoplay: autoPlay })}>\n          <video\n            className={`media-gallery__item-gifv-thumbnail${letterbox ? ' letterbox' : ''}`}\n            aria-label={attachment.get('description')}\n            role='application'\n            src={attachment.get('url')}\n            onClick={this.handleClick}\n            onMouseEnter={this.handleMouseEnter}\n            onMouseLeave={this.handleMouseLeave}\n            autoPlay={autoPlay}\n            loop\n            muted\n          />\n\n          <span className='media-gallery__gifv__label'>GIF</span>\n        </div>\n      );\n    }\n\n    return (\n      <div className={classNames('media-gallery__item', { standalone })} key={attachment.get('id')} style={{ left: left, top: top, right: right, bottom: bottom, width: `${width}%`, height: `${height}%` }}>\n        {thumbnail}\n      </div>\n    );\n  }\n\n}\n\n@injectIntl\nexport default class MediaGallery extends React.PureComponent {\n\n  static propTypes = {\n    sensitive: PropTypes.bool,\n    revealed: PropTypes.bool,\n    standalone: PropTypes.bool,\n    letterbox: PropTypes.bool,\n    fullwidth: PropTypes.bool,\n    media: ImmutablePropTypes.list.isRequired,\n    size: PropTypes.object,\n    onOpenMedia: PropTypes.func.isRequired,\n    intl: PropTypes.object.isRequired,\n  };\n\n  static defaultProps = {\n    standalone: false,\n  };\n\n  state = {\n    visible: this.props.revealed === undefined ? (!this.props.sensitive || displaySensitiveMedia) : this.props.revealed,\n  };\n\n  componentWillReceiveProps (nextProps) {\n    if (!is(nextProps.media, this.props.media)) {\n      this.setState({ visible: !nextProps.sensitive });\n    }\n  }\n\n  handleOpen = () => {\n    this.setState({ visible: !this.state.visible });\n  }\n\n  handleClick = (index) => {\n    this.props.onOpenMedia(this.props.media, index);\n  }\n\n  handleRef = (node) => {\n    if (node /*&& this.isStandaloneEligible()*/) {\n      // offsetWidth triggers a layout, so only calculate when we need to\n      this.setState({\n        width: node.offsetWidth,\n      });\n    }\n  }\n\n  isStandaloneEligible() {\n    const { media, standalone } = this.props;\n    return standalone && media.size === 1 && media.getIn([0, 'meta', 'small', 'aspect']);\n  }\n\n  render () {\n    const { media, intl, sensitive, letterbox, fullwidth } = this.props;\n    const { width, visible } = this.state;\n    const size = media.take(4).size;\n\n    let children;\n\n    const style = {};\n\n    if (this.isStandaloneEligible() && width) {\n      style.height = width / this.props.media.getIn([0, 'meta', 'small', 'aspect']);\n    }\n\n    if (!visible) {\n      let warning = <FormattedMessage {...(sensitive ? messages.warning : messages.hidden)} />;\n\n      children = (\n        <button className='media-spoiler' type='button' onClick={this.handleOpen}>\n          <span className='media-spoiler__warning'>{warning}</span>\n          <span className='media-spoiler__trigger'><FormattedMessage {...messages.toggle} /></span>\n        </button>\n      );\n    } else {\n      if (this.isStandaloneEligible()) {\n        children = <Item standalone attachment={media.get(0)} onClick={this.handleClick} displayWidth={width} />;\n      } else {\n        children = media.take(4).map((attachment, i) => <Item key={attachment.get('id')} onClick={this.handleClick} attachment={attachment} index={i} size={size} letterbox={letterbox} displayWidth={width} />);\n      }\n    }\n\n    const computedClass = classNames('media-gallery', `size-${size}`, { 'full-width': fullwidth });\n\n    return (\n      <div className={computedClass} style={style} ref={this.handleRef}>\n        {visible ? (\n          <div className='sensitive-info'>\n            <IconButton\n              icon='eye'\n              onClick={this.handleOpen}\n              overlay\n              title={intl.formatMessage(messages.toggle_visible)}\n            />\n            {sensitive ? (\n              <span className='sensitive-marker'>\n                <FormattedMessage {...messages.sensitive} />\n              </span>\n            ) : null}\n          </div>\n        ) : null}\n\n        {children}\n      </div>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// app/javascript/mnt/gentoo/home/haelwenn/Sources/git/hacktivis.me/git/mastofe/app/javascript/flavours/glitch/components/media_gallery.js"],"sourceRoot":""}